<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BAMBAM — Daily WOD</title>

<!-- PWA / iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Daily WOD">
<meta name="theme-color" content="#0f1115">
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='128' height='128'%3E%3Crect width='100%25' height='100%25' fill='%230f1115'/%3E%3Ctext x='50%25' y='58%25' text-anchor='middle' fill='%23e8eaf0' font-size='64' font-family='Arial'%3E%F0%9F%8F%8B%EF%B8%8F%3C/text%3E%3C/svg%3E">
<link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABb0P4JAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABcUlEQVR42u3RAQ0AAAwCoNm/9C1gkQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwqgkAAQh7b7cAAAAASUVORK5CYII=" />

<style>
  :root{ --bg:#0f1115; --card:#151922; --ink:#e8eaf0; --muted:#aab0c0; --accent:#61dafb; --border:#2a3345; }
  *{box-sizing:border-box}
  body{margin:0;padding:24px;background:var(--bg);color:var(--ink);
       font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  h1,h2,h3{margin:0 0 8px;line-height:1.15}
  h1{font-size:28px} h2{font-size:20px;color:var(--muted);font-weight:600} h3{font-size:16px;color:var(--muted);font-weight:600}
  .wrap{max-width:900px;margin:0 auto;display:grid;gap:16px}
  .card{background:var(--card);border:1px solid #222937;border-radius:12px;padding:16px;box-shadow:0 4px 18px rgba(0,0,0,.25)}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:center}
  button{background:#111723;color:var(--ink);border:1px solid var(--border);border-radius:8px;padding:10px 12px;cursor:pointer;font:inherit}
  button:hover{border-color:var(--accent)}
  .pill{display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid var(--border);background:#0d1320;color:var(--muted);font-size:12px;margin-right:6px}
  .meta{color:var(--muted);font-size:14px}
  ul{margin:8px 0 0 20px} li{margin:4px 0}
  .notice{background:#1a2030;border-left:4px solid var(--accent);padding:10px 12px;border-radius:8px}
  .center{text-align:center}
  .date-chip{cursor:pointer;display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:#0d1320;user-select:none}
  .date-chip:hover{border-color:var(--accent)}
  #dateWrap{display:flex;justify-content:center;position:relative}
  .libstat{margin-top:6px;text-align:center;font-size:12px;color:#7e88a0}

  /* Calendar dropdown */
  .cal{position:absolute;top:calc(100% + 8px);left:50%;transform:translateX(-50%);
       width:320px;background:var(--card);border:1px solid var(--border);border-radius:12px;
       box-shadow:0 12px 36px rgba(0,0,0,.45);padding:12px;display:none;z-index:1000}
  .cal.show{display:block}
  .cal header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .cal .hdr-btn{background:#111723;border:1px solid var(--border);border-radius:8px;padding:6px 10px;font-size:13px;color:var(--ink);cursor:pointer}
  .cal .hdr-btn:hover{border-color:var(--accent)}
  .cal .label{font-weight:700;color:#e8eaf0}
  .cal .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-top:8px}
  .cal .dow{font-size:12px;color:var(--muted);text-align:center}
  .cal .day{font-size:13px;text-align:center;padding:6px 0;border-radius:8px;border:1px solid transparent;cursor:pointer}
  .cal .day:hover{border-color:var(--accent);background:#0d1320}
  .cal .muted{opacity:.4}
  .cal .today{outline:1px dashed var(--accent);outline-offset:2px}
  .cal .selected{background:#0d1320;border-color:var(--accent)}

  @media print{ .controls, .footer, .cal {display:none} body{background:white;color:#111} .card{box-shadow:none;border-color:#ddd}}
  footer{margin-top:24px;text-align:center;color:#9aa3b2;font-size:12px}
  footer a{color:#9aa3b2;text-decoration:none}
  footer a:hover{color:#e8eaf0}
</style>
</head>
<body>
<div class="wrap">

  <!-- HEADER + CONTROLS -->
  <div class="card">
    <h1 class="center">Daily WOD</h1>
    <div id="dateWrap">
      <div id="todayStr" class="meta center date-chip" title="Pick a date"></div>
      <div id="cal" class="cal" aria-hidden="true"></div>
    </div>
    <div id="libstat" class="libstat">Loading workouts…</div>
    <div class="row controls" style="margin-top:8px;">
      <button id="prevBtn">◀ Prev</button>
      <button id="todayBtn">Today</button>
      <button id="nextBtn">Next ▶</button>
    </div>
  </div>

  <!-- WOD CARD -->
  <div class="card">
    <div class="row" style="justify-content:space-between">
      <h2 id="wodTitle">Workout</h2>
      <div>
        <span class="pill" id="typePill"></span>
        <span class="pill" id="timePill"></span>
        <span class="pill" id="targetPill"></span>
      </div>
    </div>
    <div id="wodBody"></div>
    <div class="meta" id="wodNotes" style="margin-top:8px;"></div>
    <div id="wodTribute" class="notice" style="display:none;margin-top:8px;"></div>
  </div>

  <!-- WARMUP / COOLDOWN -->
  <div class="card">
    <h3>Warm-Up</h3>
    <div id="warmup" class="notice"></div>
  </div>

  <div class="card">
    <h3>Cooldown</h3>
    <div id="cooldown" class="notice"></div>
  </div>

  <footer>© 2025 <a href="https://bambambuilt.com" target="_blank" rel="noopener">bambambuilt.com</a>. All Rights Reserved.</footer>
</div>

<!-- Load the big list -->
<script src="wods.js"></script>

<script>
/* ========= UTIL ========= */
const dayMS = 86400000;
const MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"];
const DOW=["S","M","T","W","T","F","S"];
const clamp=(n,min,max)=>Math.max(min,Math.min(max,n));
function daysInYear(y){return ((y%4===0 && y%100!==0) || (y%400===0)) ? 366 : 365;}
function fmtDate(d){return d.toLocaleDateString(undefined,{weekday:'long',year:'numeric',month:'long',day:'numeric'})}
function doyFromDate(d){const start=new Date(d.getFullYear(),0,1);return Math.floor((d-start)/dayMS)+1;}
function dateFromDoy(y,doy){const d=new Date(y,0,1);d.setDate(doy);return d;}
function memorialDayDOY(y){ // last Monday in May
  const lastMay = new Date(y,4,31);
  const dow = lastMay.getDay(); // 0 Sun..6 Sat
  const monday = 31 - ((dow+6)%7);
  return doyFromDate(new Date(y,4,monday));
}
function mdToDoy(y, mmdd){ // "MM-DD" -> DOY
  const mm = parseInt(mmdd.slice(0,2),10);
  const dd = parseInt(mmdd.slice(3,5),10);
  return doyFromDate(new Date(y, mm-1, dd));
}

/* ========= YOUR GEAR strings used inside generators ========= */
const DB2="2×50 lb", DB1="1×50 lb", KB53="53 lb", KB35="35 lb", BOX='24"';

/* ========= ONE WARMUP / ONE COOLDOWN ========= */
const ONE_WARMUP =
  `8–10 min easy build: row or jog (progress every 2 min).<br>`+
  `Then 2 rounds (quality): 10 Wall Balls, 6 lunges/leg, 15s active hang or kip swings, 8 push-ups.`;
const ONE_COOLDOWN =
  `3–5 min easy walk/row to drop HR.<br>`+
  `2× :45 couch stretch / side.<br>`+
  `2× :30–:45 banded lat stretch or passive hang.<br>`+
  `Ankle rocks x10/side.`;

/* ========= PULL IN THE LIBRARY ========= */
const BANK = Array.isArray(window.WOD_BANK) ? window.WOD_BANK.slice() : [];
const TRIBUTES = window.WOD_TRIBUTES || {};
const DATE_MAP = window.WOD_DATE_MAP || {};
const libstat = document.getElementById('libstat');
libstat.textContent = BANK.length ? `Known WODs: ${BANK.length}` : 'wods.js not found (using generators only)';

/* ========= QUICK LOOKUP BY TITLE ========= */
const TITLE_INDEX = new Map();
BANK.forEach((w,i)=>TITLE_INDEX.set(w.title,i));

/* ========= SIMPLE GENERATORS for non-benchmark days ========= */
function mulberry32(a){return function(){let t=a+=0x6D2B79F5;t=Math.imul(t^(t>>>15),t|1);t^=t+Math.imul(t^(t>>>7),t|61);return((t^(t>>>14))>>>0)/4294967296}}
function choice(rng,arr){return arr[Math.floor(rng()*arr.length)]}

const MONO = ["Run 400m","Run 600m","Run 800m","Run 1000m","Row 500m","Row 750m","Row 1000m","Row 1500m","150 Single-unders","100 Double-unders"];
const GYM  = ["15 Pull-ups","20 Push-ups","25 Sit-ups","20 Air Squats","15 Burpees","12 Pike Push-ups","20 V-ups","30 Wall Balls"];
const DBB  = [`16 DB Thrusters — ${DB2}`,`14 DB Push Press — ${DB2}`,`16 DB Front Squats — ${DB2}`,`14 DB Power Cleans — ${DB2}`,`20 DB Deadlifts — ${DB2}`,`16 Alt DB Snatches — ${DB1}`];
const KBB  = [`25 KB Swings — ${KB53}`,`20 KB Goblet Squats — ${KB53}`,`14 KB Clean & Press (alt) — ${KB53}`,`20 KB Swings — ${KB35}`];
const BOXM = [`20 Box Jumps — ${BOX}`,`14 Burpee Box Jump-Overs — ${BOX}`];
const WB   = ["25 Wall Balls","30 Wall Balls","40 Wall Balls"];

function amrapLong(rng){
  const mins=choice(rng,[20,24,30,40]);
  const a=choice(rng,MONO.concat(WB)); const b=choice(rng,DBB.concat(KBB).concat(BOXM)); const c=choice(rng,GYM);
  return {title:`AMRAP ${mins} — Triplet`, type:"AMRAP", time:String(mins),
    body:[`As many rounds as possible in ${mins} minutes:`,`• ${a}`,`• ${b}`,`• ${c}`], notes:"Aim ~2–3 min/round; smooth pacing."};
}
function emomLong(rng){
  const mins=choice(rng,[24,30,36,40]);
  const s1=choice(rng, DBB.concat(KBB).concat(WB)); const s2=choice(rng, GYM.concat(BOXM)); const s3=choice(rng, MONO);
  return {title:`EMOM ${mins} — Rotate 3`, type:"EMOM", time:String(mins),
    body:[`Every minute for ${mins} min, rotate:`,`1) ${s1}`,`2) ${s2}`,`3) ${s3}`,"Finish each minute in ~40–45s."], notes:"Hold windows; quality first."};
}
function chipperLong(rng){
  const count=choice(rng,[8,9,10,11,12]);
  const pool = WB.concat(MONO, DBB, KBB, GYM, BOXM);
  const tasks = [];
  while(tasks.length<count){
    const pick = choice(rng,pool);
    if(!tasks.includes(pick)) tasks.push(pick);
  }
  return {title:"Chipper — For Time (Long)", type:"For Time", time:"30–60",
    body:["Complete for time:"].concat(tasks.map(t=>"• "+t)), notes:"Break small and keep moving. Target 30–60 min."};
}

/* ========= YEAR BUILDER =========
   - Pins specific dates from DATE_MAP
   - Pins Memorial Day -> Murph (overrides)
   - Ensures EVERY WOD in BANK appears at least once (sprinkled)
   - Fills remaining days with generators (AMRAP/EMOM/Chipper weekly)
*/
function buildSchedule(year){
  const days=daysInYear(year);
  const out=new Array(days);
  const pinned=new Map();

  // 1) Static pins from DATE_MAP (if the title exists in BANK)
  Object.entries(DATE_MAP).forEach(([mmdd,title])=>{
    const idx = TITLE_INDEX.get(title);
    if(idx!==undefined){
      const doy = mdToDoy(year, mmdd);
      pinned.set(doy, idx);
    }
  });

  // 2) Dynamic Memorial Day -> Murph (override)
  const murphIdx = TITLE_INDEX.get("Murph");
  if(murphIdx!==undefined){
    pinned.set(memorialDayDOY(year), murphIdx);
  }
  // 3) Make sure 09-11 -> Glen (Home) even if someone edited DATE_MAP wrong
  const glenIdx = TITLE_INDEX.get("Glen (Home)");
  if(glenIdx!==undefined){
    pinned.set(mdToDoy(year,"09-11"), glenIdx);
  }

  // 4) Place pinned
  pinned.forEach((idx,doy)=>{
    const w=BANK[idx];
    out[doy-1] = {title:w.title,type:w.type,time:w.time,body:w.body.slice(),notes:w.notes||"",named:true};
  });

  // 5) Sprinkle the rest of BANK evenly across the year (on every 9th day if free),
  //    guaranteeing all appear at least once.
  const remainingIdx = [];
  for(let i=0;i<BANK.length;i++){
    // skip those already pinned, but still include; duplicates are OK if pinned, but we want at least once elsewhere
    remainingIdx.push(i);
  }
  let cursor = 9;
  while(remainingIdx.length){
    // find a free day at/after cursor
    while(cursor<=days && out[cursor-1]) cursor++;
    if(cursor>days) break;
    const idx = remainingIdx.shift();
    const w = BANK[idx];
    out[cursor-1] = {title:w.title,type:w.type,time:w.time,body:w.body.slice(),notes:w.notes||"",named:true};
    cursor += 9;
  }
  // Any left (because of collisions or end-of-year) — place in next available free days
  let scan=1;
  while(remainingIdx.length && scan<=days){
    if(!out[scan-1]){
      const idx = remainingIdx.shift();
      const w = BANK[idx];
      out[scan-1] = {title:w.title,type:w.type,time:w.time,body:w.body.slice(),notes:w.notes||"",named:true};
    }
    scan++;
  }

  // 6) Fill the rest with generators (pattern: Sun chipper, Mon/Wed/Fri AMRAP, Tue/Thu/Sat EMOM)
  const rng = mulberry32(1337 + year);
  for(let d=1; d<=days; d++){
    if(out[d-1]) continue;
    const dow=(d-1)%7;
    const gen = (dow===6)?chipperLong : (dow%2===0?amrapLong:emomLong);
    out[d-1] = gen(rng);
  }
  return out;
}

/* ========= UI ========= */
const elTitle   = document.getElementById("wodTitle");
const elBody    = document.getElementById("wodBody");
const elNotes   = document.getElementById("wodNotes");
const elType    = document.getElementById("typePill");
const elTime    = document.getElementById("timePill");
const elTarget  = document.getElementById("targetPill");
const elTribute = document.getElementById("wodTribute");
const dateChip  = document.getElementById("todayStr");
const calEl     = document.getElementById("cal");

document.getElementById("warmup").innerHTML = ONE_WARMUP;
document.getElementById("cooldown").innerHTML = ONE_COOLDOWN;

let currentDate=new Date();
let currentYear=currentDate.getFullYear();
let YEAR = buildSchedule(currentYear);

function isCommemorative(title){ return !!TRIBUTES[title]; }
function paceHint(w){ return (w.type==="For Time") ? "Target: 30–60 min" : `Target: ${w.time} min`; }

function renderByDate(dt){
  if(dt.getFullYear()!==currentYear){ currentYear=dt.getFullYear(); YEAR=buildSchedule(currentYear); }
  const doy = doyFromDate(dt);
  const w = YEAR[clamp(doy,1,daysInYear(currentYear))-1];

  dateChip.textContent = fmtDate(dt);
  elTitle.textContent  = w.named ? `${w.title} (Benchmark)` : w.title;
  elType.textContent   = w.type;
  elTime.textContent   = w.time;
  elTarget.textContent = paceHint(w);
  elBody.innerHTML     = "<ul>"+w.body.map(l=>`<li>${l}</li>`).join("")+"</ul>";
  elNotes.textContent  = w.notes || "";

  if(isCommemorative(w.title)){ elTribute.style.display="block"; elTribute.textContent=TRIBUTES[w.title]; }
  else { elTribute.style.display="none"; elTribute.textContent=""; }

  currentDate = dt;
  if(calEl.classList.contains('show')) buildCalendar(currentDate.getFullYear(), currentDate.getMonth());
}

/* ========= Calendar (robust; nav arrows don't close the panel) ========= */
let calYear=currentDate.getFullYear(), calMonth=currentDate.getMonth();

function buildCalendar(year, month){
  calYear=year; calMonth=month;
  const first=new Date(year,month,1);
  const firstDow=first.getDay();
  const daysThis=new Date(year,month+1,0).getDate();
  const daysPrev=new Date(year,month,0).getDate();

  let html = `
    <header>
      <button class="hdr-btn" id="calPrev">&larr;</button>
      <div class="label">${MONTHS[month]} ${year}</div>
      <button class="hdr-btn" id="calNext">&rarr;</button>
    </header>
    <div class="grid">`;
  for(const d of DOW) html += `<div class="dow">${d}</div>`;
  for(let i=0;i<firstDow;i++){ html+=`<div class="day muted">${daysPrev-firstDow+1+i}</div>`; }
  const today=new Date(); const isThisMonth=(today.getFullYear()===year && today.getMonth()===month);
  for(let d=1; d<=daysThis; d++){
    const isSelected=(currentDate.getFullYear()===year && currentDate.getMonth()===month && currentDate.getDate()===d);
    const cls = "day"+(isThisMonth && d===today.getDate()?" today":"")+(isSelected?" selected":"");
    html += `<div class="${cls}" data-day="${d}">${d}</div>`;
  }
  const used = firstDow + daysThis;
  const pad = (7 - (used % 7)) % 7;
  for(let i=1;i<=pad;i++) html += `<div class="day muted">${i}</div>`;
  html += `</div>`;
  calEl.innerHTML = html;

  // stop clicks inside calendar from closing it
  calEl.onclick = (e)=> { e.stopPropagation(); };

  document.getElementById('calPrev').onclick=(e)=>{ e.stopPropagation();
    const m=month-1; buildCalendar(m<0?year-1:year, m<0?11:m);
  };
  document.getElementById('calNext').onclick=(e)=>{ e.stopPropagation();
    const m=month+1; buildCalendar(m>11?year+1:year, m>11?0:m);
  };
  calEl.querySelectorAll('.day[data-day]').forEach(el=>{
    el.onclick=(e)=>{
      e.stopPropagation();
      const day=Number(el.getAttribute('data-day'));
      renderByDate(new Date(year, month, day));
      closeCalendar();
    };
  });
}

function openCalendar(){
  buildCalendar(currentDate.getFullYear(), currentDate.getMonth());
  calEl.classList.add('show'); calEl.setAttribute('aria-hidden','false');
  setTimeout(()=>document.addEventListener('click', outsideClose),0);
}
function closeCalendar(){
  calEl.classList.remove('show'); calEl.setAttribute('aria-hidden','true');
  document.removeEventListener('click', outsideClose);
}
function outsideClose(e){
  if(!calEl.contains(e.target) && e.target!==dateChip){ closeCalendar(); }
}

/* ========= Controls ========= */
document.getElementById("prevBtn").onclick=()=>{ const d=new Date(currentDate); d.setDate(d.getDate()-1); renderByDate(d); };
document.getElementById("nextBtn").onclick=()=>{ const d=new Date(currentDate); d.setDate(d.getDate()+1); renderByDate(d); };
document.getElementById("todayBtn").onclick=()=>{ renderByDate(new Date()); };

dateChip.addEventListener('click', (e)=>{
  e.stopPropagation();
  if(calEl.classList.contains('show')) closeCalendar(); else openCalendar();
});
document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && calEl.classList.contains('show')) closeCalendar(); });

/* ========= PWA manifest + SW ========= */
(function(){
  const icon192 = document.querySelector('link[rel="apple-touch-icon"]').href;
  const manifest = {
    name: "BAMBAM — Daily WOD",
    short_name: "Daily WOD",
    start_url: "./",
    display: "standalone",
    background_color: "#0f1115",
    theme_color: "#0f1115",
    icons: [{ src: icon192, sizes: "192x192", type: "image/png" },
            { src: icon192, sizes: "512x512", type: "image/png" }]
  };
  const manBlob = new Blob([JSON.stringify(manifest)], {type:"application/manifest+json"});
  const manLink = document.createElement('link'); manLink.rel='manifest'; manLink.href=URL.createObjectURL(manBlob);
  document.head.appendChild(manLink);

  if('serviceWorker' in navigator){
    const swCode = `
      const CACHE='bb-wod-v1';
      self.addEventListener('install',e=>{
        e.waitUntil(caches.open(CACHE).then(c=>c.addAll(['./'])));
        self.skipWaiting();
      });
      self.addEventListener('activate',e=>{ self.clients.claim(); });
      self.addEventListener('fetch',e=>{
        const req=e.request;
        if(req.mode==='navigate'){ e.respondWith(fetch(req).catch(()=>caches.match('./'))); return; }
        e.respondWith(caches.match(req).then(r=>r||fetch(req)));
      });
    `;
    const swURL = URL.createObjectURL(new Blob([swCode], {type:'text/javascript'}));
    navigator.serviceWorker.register(swURL, {scope:'./'}).catch(()=>{});
  }
})();

/* ========= Kickoff ========= */
document.addEventListener("DOMContentLoaded", ()=>{ dateChip.textContent = fmtDate(currentDate); renderByDate(currentDate); });

</script>
</body>
</html>