<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BAMBAM — Daily WOD</title>

<!-- PWA / iOS -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Daily WOD">
<meta name="theme-color" content="#0f1115">
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='128' height='128'%3E%3Crect width='100%25' height='100%25' fill='%230f1115'/%3E%3Ctext x='50%25' y='58%25' text-anchor='middle' fill='%23e8eaf0' font-size='64' font-family='Arial'%3E%F0%9F%8F%8B%EF%B8%8F%3C/text%3E%3C/svg%3E">
<link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABb0P4JAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABcUlEQVR42u3RAQ0AAAwCoNm/9C1gkQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwqgkAAQh7b7cAAAAASUVORK5CYII=" />

<!-- Load known WODs -->
<script src="wods.js"></script>

<style>
  :root{ --bg:#0f1115; --card:#151922; --ink:#e8eaf0; --muted:#aab0c0; --accent:#61dafb; --border:#2a3345; }
  *{box-sizing:border-box}
  body{margin:0;padding:24px;background:var(--bg);color:var(--ink);
       font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  h1,h2,h3{margin:0 0 8px;line-height:1.15}
  h1{font-size:28px} h2{font-size:20px;color:var(--muted);font-weight:600} h3{font-size:16px;color:var(--muted);font-weight:600}
  .wrap{max-width:900px;margin:0 auto;display:grid;gap:16px}
  .card{background:var(--card);border:1px solid #222937;border-radius:12px;padding:16px;box-shadow:0 4px 18px rgba(0,0,0,.25)}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:center}
  button{background:#111723;color:var(--ink);border:1px solid var(--border);border-radius:8px;padding:10px 12px;cursor:pointer;font:inherit}
  button:hover{border-color:var(--accent)}
  .pill{display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid var(--border);background:#0d1320;color:#aab0c0;font-size:12px;margin-right:6px}
  .meta{color:#aab0c0;font-size:14px}
  .warn{color:#ffb85c;font-size:12px;margin-top:6px;text-align:center}
  ul{margin:8px 0 0 20px} li{margin:4px 0}
  .notice{background:#1a2030;border-left:4px solid var(--accent);padding:10px 12px;border-radius:8px}
  .center{text-align:center}
  .date-chip{cursor:pointer;display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:#0d1320;user-select:none}
  .date-chip:hover{border-color:var(--accent)}
  #dateWrap{display:flex;justify-content:center;position:relative}
  .cal{position:absolute;top:calc(100% + 8px);left:50%;transform:translateX(-50%);width:320px;background:var(--card);border:1px solid var(--border);border-radius:12px;box-shadow:0 12px 36px rgba(0,0,0,.45);padding:12px;display:none;z-index:1000}
  .cal.show{display:block}
  .cal header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .cal .hdr-btn{background:#111723;border:1px solid var(--border);border-radius:8px;padding:6px 10px;font-size:13px;color:var(--ink);cursor:pointer}
  .cal .hdr-btn:hover{border-color:var(--accent)}
  .cal .label{font-weight:700;color:#e8eaf0}
  .cal .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-top:8px}
  .cal .dow{font-size:12px;color:#aab0c0;text-align:center}
  .cal .day{font-size:13px;text-align:center;padding:6px 0;border-radius:8px;border:1px solid transparent;cursor:pointer}
  .cal .day:hover{border-color:var(--accent);background:#0d1320}
  .cal .muted{opacity:.4}
  .cal .today{outline:1px dashed var(--accent);outline-offset:2px}
  .cal .selected{background:#0d1320;border-color:var(--accent)}
  @media print{ .controls, .footer, .cal {display:none} body{background:white;color:#111} .card{box-shadow:none;border-color:#ddd}}
  footer{margin-top:24px;text-align:center;color:#9aa3b2;font-size:12px}
  footer a{color:#9aa3b2;text-decoration:none}
  footer a:hover{color:#e8eaf0}
</style>
</head>
<body>
<div class="wrap">

  <div class="card">
    <h1 class="center">Daily WOD</h1>
    <div id="dateWrap">
      <div id="todayStr" class="meta center date-chip" title="Pick a date"></div>
      <div id="cal" class="cal" aria-hidden="true"></div>
    </div>
    <div id="warn" class="warn" style="display:none"></div>
    <div class="row controls" style="margin-top:8px;">
      <button id="prevBtn">◀ Prev</button>
      <button id="todayBtn">Today</button>
      <button id="nextBtn">Next ▶</button>
    </div>
  </div>

  <div class="card">
    <div class="row" style="justify-content:space-between">
      <h2 id="wodTitle">Workout</h2>
      <div>
        <span class="pill" id="typePill"></span>
        <span class="pill" id="timePill"></span>
        <span class="pill" id="targetPill"></span>
      </div>
    </div>
    <div id="wodBody"></div>
    <div class="meta" id="wodNotes" style="margin-top:8px;"></div>
    <div id="wodTribute" class="notice" style="display:none;margin-top:8px;"></div>
  </div>

  <div class="card">
    <h3>Warm-Up</h3>
    <div id="warmup" class="notice"></div>
  </div>

  <div class="card">
    <h3>Cooldown</h3>
    <div id="cooldown" class="notice"></div>
  </div>

  <footer>© 2025 <a href="https://bambambuilt.com" target="_blank" rel="noopener">bambambuilt.com</a>. All Rights Reserved.</footer>
</div>

<script>
function mulberry32(a){return function(){let t=a+=0x6D2B79F5;t=Math.imul(t^(t>>>15),t|1);t^=t+Math.imul(t^(t>>>7),t|61);return((t^(t>>>14))>>>0)/4294967296}}
function choice(rng,arr){return arr[Math.floor(rng()*arr.length)]}
function shuffleInPlace(rng,arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(rng()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]}}
function clamp(n,min,max){return Math.max(min,Math.min(max,n))}
function daysInYear(y){return ((y%4===0 && y%100!==0) || (y%400===0)) ? 366 : 365;}
function doyFromDate(dt){const start=new Date(dt.getFullYear(),0,1); return Math.floor((dt - start)/86400000)+1;}
function fmtDate(d){return d.toLocaleDateString(undefined,{weekday:'long',year:'numeric',month:'long',day:'numeric'})}
function localDOY(year,month,day){const d=new Date(year,month,day);return Math.floor((d - new Date(year,0,0))/86400000)}
function lastMondayOfMayLocal(year){const last=new Date(year,4,31);const dow=last.getDay();return 31-((dow+6)%7)}

const DB2="2x50 lb", DB1="1x50 lb", KB53="53 lb", KB35="35 lb", BOX='24"';

function modalitiesFrom(w){const t=w.body.join(' ');
  return {run:/\b(\d+\s?m Run|km Run|mile Run)\b/i.test(t),row:/\b(Row( \d+m|\sfor\sCalories)?|Cal Row|km Row|5k Row)\b/i.test(t),rope:/Double-unders|Single-unders/i.test(t),
  wb:/Wall Balls?/i.test(t),pull:/Pull-ups|Chest-to-Bar|Bar Muscle-ups|L-Pull-ups/i.test(t),ttb:/Toes-to-Bar|Hanging Knee Raises/i.test(t),
  hspu:/Handstand Push-ups|Wall Walks/i.test(t),box:/Box Jump/i.test(t),kb:/\bKB\b/i.test(t),db:/\bDB\b/i.test(t),squat:/Squats?|Thrusters|Front Squats|Goblet Squats/i.test(t),hinge:/Deadlifts?|Power Cleans?|Swings|Snatches|Clean & Jerk/i.test(t)}}
const WU={run:'5-8 min easy jog, then 2 rounds: 20s A-skips, 20s high knees, 20s butt kicks, 10 walking lunges/leg.',
          row:'4 min easy row. Drill 10 hard strokes, then 2x (20s hard / 40s easy).',
          rope:'2 min singles -> 3x (20 DU attempts or 30 singles + 10 penguin taps). 20 calf raises + 10 ankle rocks/side.',
          pull:'2x 20s active hang + 8 scap pulls. 2x10 kip swings. 2-3 easy pull-up/row sets.',
          ttb:'8 hollow rocks + 8 beat swings x2. 10 hanging knee raises or small TTB sets.',
          hspu:'Wrist circles 60s. 2x8 pike HSPU to abmat. 2 wall walks to 20s hold.',
          squat:'2 rounds: 10 air squats, 8 Cossack (4/side), 10 light wall balls, 10 ankle rocks/side.',
          hinge:'2 rounds: 10 glute bridges, 10 light DB RDL, 10 easy KB swings.',
          kb:'10 halos each way, 10 front rack shrugs, 10 squat-to-stand.',
          db:'Front rack flow: 10s rack hold + 8 strict press light + 8 front squats light.',
          box:'10 step-ups/leg, 10 pogo jumps, 10 small box jumps.',
          wb:'10 wall slides, 10-15 easy wall balls + ankle rocks.',
          general:'5-7 min easy cardio -> 2 rounds: 8 push-ups, 10 air squats, 10 sit-ups.'};
const CD={run:'3-5 min walk, then 45s calf + 45s hamstring/side.',row:'2-3 min easy row, 45s thoracic child pose + 45s pec doorway/side.',
          rope:'45s calf/side + foot/plantar massage 1-2 min.',pull:'60s passive hang or banded lat/side; thread-the-needle 30s/side.',
          ttb:'Banded lat + 45s hip flexor/side.',hspu:'45s triceps/side + 45s pec doorway/side.',
          squat:'2x 45s couch stretch/side + 45s adductor hold.',hinge:'45s hamstring/side + 5 gentle McKenzie press-ups.',
          kb:'45s rack/forearm stretch/side + 45s lat stretch/side.',db:'45s front-rack/pec/side + 45s triceps/side.',
          box:'45s hip flexor/side + 45s calves.',wb:'45s thoracic open + 45s ankle (knee-to-wall)/side.',general:'3-5 min easy spin/walk, breathe down.'};

let BENCH=[], TRIBUTES={}, DATE_MAP={};
const DEFAULT_TRIBUTES={'Murph':'Honors U.S. Navy Lt. Michael P. Murphy (MOH), KIA 2005.',
'Glen (Home)':'Honors U.S. Navy SEAL Glen Doherty, KIA Sept 11, 2012.',
'Chad 1000X (24")':'Honors Navy SEAL Chad Wilkinson (2018).',
'Kalsu (DB Thruster)':'Honors 1LT James Robert Kalsu (1970).',
'12 Days of Christmas (Home)':'Seasonal workout.'};

const MONO=['Run 400m','Run 600m','Run 800m','Run 1000m','Row 500m','Row 750m','Row 1000m','Row 1500m','150 Single-unders','100 Double-unders','Shuttle Run 200m'];
const GYM=['Pull-ups','Chest-to-Bar Pull-ups','Bar Muscle-ups','Toes-to-Bar','Push-ups','Sit-ups','Air Squats','Pistols (alt)','Handstand Push-ups','Burpees','Pike Push-ups','V-ups','Wall Walks','Hanging Knee Raises','Wall Balls'];
const DBB=[{name:'DB Thrusters',load:DB2},{name:'DB Push Press',load:DB2},{name:'DB Front Squats',load:DB2},{name:'DB Power Cleans',load:DB2},{name:'DB Deadlifts',load:DB2},{name:'Alt DB Snatches',load:DB1},{name:'DB Hang Clean & Jerks',load:DB1}];
const KBB=[{name:'KB Swings',load:KB53},{name:'KB Goblet Squats',load:KB53},{name:'KB Clean & Press (alt)',load:KB53},{name:'KB Swings',load:KB35}];
const BOXM=['Box Jumps','Burpee Box Jump-Overs'];
const REP_RULES={'Pull-ups':[10,12,15,20],'Chest-to-Bar Pull-ups':[10,12,15],'Bar Muscle-ups':[5,6,8],'Toes-to-Bar':[10,12,15],'Push-ups':[10,15,20,25],
'Sit-ups':[20,30,40],'Air Squats':[20,30,40,50],'Pistols (alt)':[5,10,16,20],'Handstand Push-ups':[6,9,12],'Burpees':[12,15,20],'Pike Push-ups':[12,15,20],
'V-ups':[15,20,25],'Wall Walks':[3,4,5],'Hanging Knee Raises':[15,20,25],'Wall Balls':[20,25,30,40],'DB Thrusters':[9,12,15],'DB Push Press':[10,12,15],
'DB Front Squats':[12,15,20],'DB Power Cleans':[10,12,14],'DB Deadlifts':[16,20,24],'Alt DB Snatches':[12,16,20],'DB Hang Clean & Jerks':[10,12,16],
'KB Swings':[20,25,30],'KB Goblet Squats':[16,20,24],'KB Clean & Press (alt)':[10,12,14],'Box Jumps':[15,20,24],'Burpee Box Jump-Overs':[10,12,14]};
const AMRAP_SCHEMES={3:[{label:'Triplet',pattern:null},{label:'15/10/5',pattern:[15,10,5]},{label:'21/15/9',pattern:[21,15,9]}],
4:[{label:'Quad',pattern:null},{label:'12/9/6/3',pattern:[12,9,6,3]},{label:'10s',pattern:[10,10,10,10]}],
5:[{label:'Quint',pattern:null},{label:'Desc 10-2',pattern:[10,8,6,4,2]}],
6:[{label:'Sextet',pattern:null},{label:'All 12s',pattern:[12,12,12,12,12,12]}]};
function repFor(name,rng){const a=REP_RULES[name]||[12,15,20];return a[Math.floor(rng()*a.length)]}
function fmtRep(rep,mv){return (typeof mv==='string')? (rep+' '+mv) : (rep+' '+mv.name+' - '+mv.load)}
function pickGym(rng){return choice(rng,GYM)} function pickDB(rng){return choice(rng,DBB)} function pickKB(rng){return choice(rng,KBB)} function pickBOX(rng){return choice(rng,BOXM)}
function pickAny(rng){const b=choice(rng,['GYM','DB','KB','BOX']);return b==='GYM'?pickGym(rng):b==='DB'?pickDB(rng):b==='KB'?pickKB(rng):pickBOX(rng)}
function amrapLong(rng){const mins=choice(rng,[20,24,30,40]);const depth=choice(rng,[3,3,4,4,5,6]);const scheme=choice(rng,AMRAP_SCHEMES[depth]);
  const label=scheme.pattern?scheme.label:(depth===3?'Triplet':depth===4?'Quad':depth===5?'Quint':'Sextet');const items=[];let monoUsed=false;
  while(items.length<depth){const useMono=!monoUsed && rng()<0.35;if(useMono){items.push(choice(rng,MONO)); monoUsed=true;}else{const mv=pickAny(rng);const id=(typeof mv==='string')?mv:mv.name;if(items.some(x=>((typeof x==='string')?x:(x.name||x))===id)) continue;items.push(mv);}}
  const lines=[];let p=0;for(const mv of items){if(typeof mv==='string'&&MONO.includes(mv)){lines.push(mv);continue;}const name=(typeof mv==='string')?mv:mv.name;const rep=scheme.pattern?scheme.pattern[clamp(p,0,scheme.pattern.length-1)]:repFor(name,rng);if(scheme.pattern)p++;lines.push(fmtRep(rep,mv));}
  return {title:'AMRAP '+mins+' - '+label, type:'AMRAP', time:String(mins), body:['As many rounds as possible in '+mins+' minutes:'].concat(lines), notes:'Tight transitions. Keep round times consistent.'};}
function emomLong(rng){const mins=choice(rng,[24,30,36,40]);const a=pickAny(rng),b=pickGym(rng),c=choice(rng,MONO);
  return {title:'EMOM '+mins+' - Rotate 3', type:'EMOM', time:String(mins), body:['Every minute for '+mins+' min, rotate:','1) '+fmtRep(repFor((a.name||a),rng),a),'2) '+fmtRep(repFor(b,rng),b),'3) '+c,'Finish each minute in ~40-45s.'], notes:'Hold windows; quality first.'};}
function chipperLong(rng){const count=choice(rng,[8,9,10,11,12]);const tasks=[];tasks.push(choice(rng,['25 Wall Balls','30 Wall Balls','40 Wall Balls']));tasks.push(choice(rng,MONO));
  const x=pickAny(rng);tasks.push(fmtRep(repFor((x.name||x),rng),x));const y=pickGym(rng);tasks.push(fmtRep(repFor(y,rng),y));const z=pickBOX(rng);tasks.push(fmtRep(repFor(z,rng),z));
  while(tasks.length<count){const add=(rng()<0.3)?choice(rng,MONO):(function(){const m=pickAny(rng);return fmtRep(repFor((m.name||m),rng),m);}());if(!tasks.includes(add))tasks.push(add);}
  return {title:'Chipper - For Time (Long)', type:'For Time', time:'30-60', body:['Complete for time:'].concat(tasks), notes:'Break small and keep moving. Target 30-60 min.'};}

const PIN_TITLES={MURPH:'Murph',GLEN:'Glen (Home)',CHAD:'Chad 1000X (24")',KALSU:'Kalsu (DB Thruster)',XMAS:'12 Days of Christmas (Home)'};
function resolveTitleToIndex(title){return BENCH.findIndex(b=>b.title===title)}
function getFallback(title){const map={};map[PIN_TITLES.MURPH]={title:'Murph',type:'For Time',time:'40-60',body:['For time:','1 mile Run','100 Pull-ups','200 Push-ups','300 Air Squats','1 mile Run'],notes:'Partition as needed.',named:true};
map[PIN_TITLES.GLEN]={title:'Glen (Home)',type:'For Time',time:'45-60',body:['For time:','1 mile Run','100 Pull-ups','200 Push-ups','300 Sit-ups','1 mile Run'],notes:'Partition calisthenics.',named:true};
map[PIN_TITLES.CHAD]={title:'Chad 1000X (24")',type:'For Time',time:'35-60',body:['For time:','1,000 Box Step-ups - '+BOX],notes:'Steady pace.',named:true};
map[PIN_TITLES.KALSU]={title:'Kalsu (DB Thruster)',type:'For Time',time:'20-40',body:['For time:','100 DB Thrusters - '+DB2,'Every minute: 5 Burpees (start with burpees)'],notes:'Grip and lungs.',named:true};
map[PIN_TITLES.XMAS]={title:'12 Days of Christmas (Home)',type:'For Time',time:'30-50',body:['Perform like the song (1-12 then 12-1):','1 Burpee','2 KB Swings - '+KB53,'3 Wall Balls','4 Pull-ups','5 Box Jumps - '+BOX,'6 Sit-ups','7 Push-ups','8 Alt DB Snatches - '+DB1,'9 Lunges/leg','10 Double-unders','11 KB Goblet Squats - '+KB53,'12 Cal Row'],notes:'Do not sprint early.',named:true};return map[title]||null;}
function buildPins(year){const pins=new Map();function add(m,d,title){const doy=localDOY(year,m,d);const i=resolveTitleToIndex(title);if(i>=0)pins.set(doy,{kind:'index',idx:i});else pins.set(doy,{kind:'inline',wod:getFallback(title)});}
add(4,lastMondayOfMayLocal(year),PIN_TITLES.MURPH);add(8,11,PIN_TITLES.GLEN);add(10,11,PIN_TITLES.CHAD);add(6,4,PIN_TITLES.KALSU);add(11,25,PIN_TITLES.XMAS);
if(DATE_MAP&&typeof DATE_MAP==='object'){for(const k in DATE_MAP){const m=parseInt(k.slice(0,2),10)-1;const d=parseInt(k.slice(3,5),10);if(isNaN(m)||isNaN(d))continue;const val=DATE_MAP[k];let entry=null;
if(typeof val==='number'&&BENCH[val])entry={kind:'index',idx:val};else if(typeof val==='string'){const idx=resolveTitleToIndex(val);entry=idx>=0?{kind:'index',idx}:null;}
if(entry){const doy=localDOY(year,m,d);pins.set(doy,entry);}}}return pins;}
function distributeKnown(openDays){const excluded=new Set(Object.values(PIN_TITLES));const mapTitles=new Set();if(DATE_MAP&&typeof DATE_MAP==='object'){for(const v of Object.values(DATE_MAP)){if(typeof v==='string')mapTitles.add(v);if(typeof v==='number'&&BENCH[v])mapTitles.add(BENCH[v].title);}}
const useIdx=BENCH.map((w,i)=>({i,t:w.title})).filter(x=>!excluded.has(x.t)&&!mapTitles.has(x.t)).map(x=>x.i);const rng=mulberry32(1337);shuffleInPlace(rng,useIdx);const N=Math.min(useIdx.length,openDays.length);const res=new Map();
for(let i=0;i<N;i++){const pos=Math.floor((i+0.5)*openDays.length/N);res.set(openDays[pos],{kind:'index',idx:useIdx[i]});}return res;}
function tagBody(lines){const t=lines.join(' ');return {wb:/Wall Balls?/.test(t),pull:/(Pull-ups|Chest-to-Bar|Bar Muscle-ups|L-Pull-ups|Toes-to-Bar|Hanging Knee Raises)/i.test(t),hspu:/(Handstand Push-ups|Wall Walks)/i.test(t),db:/DB /.test(t)||/DB/.test(t),kb:/KB /.test(t)||/KB/.test(t),mono:/(Run \d+|Row \d+|Shuttle Run|km Run|km Row|Double-unders|Single-unders|5 km (Run|Row))/i.test(t),box:/Box Jumps?/.test(t)}}
function violates(tags,p1,p2){if(!p1&&!p2)return false;if(p1){if(tags.wb&&p1.wb)return true;if(tags.pull&&p1.pull)return true;if(tags.hspu&&p1.hspu)return true;if(tags.db&&p1.db)return true;if(tags.kb&&p1.kb)return true;}if(tags.mono&&p1&&p2&&p1.mono&&p2.mono)return true;return false;}
function buildSchedule(year,days){const pins=buildPins(year);const open=[];for(let d=1;d<=days;d++){if(!pins.has(d))open.push(d);}const spread=distributeKnown(open);const out=new Map(pins);spread.forEach((v,k)=>out.set(k,v));return out;}
function buildYear(year){const days=daysInYear(year);const out=new Array(days),tags=new Array(days);const rng=mulberry32(1337);const slots=buildSchedule(year,days);
for(let d=1;d<=days;d++){let w=null;if(slots.has(d)){const val=slots.get(d);if(val.kind==='index'){const b=BENCH[val.idx];w={title:b.title,type:b.type,time:b.time,body:b.body.slice(),notes:b.notes,named:true};}else{w=Object.assign({},val.wod);}tags[d-1]=tagBody(w.body);}
else{const dow=(d-1)%7;const gen=(dow===6)?chipperLong:(dow%2===0?amrapLong:emomLong);for(let tries=0;tries<6;tries++){const cand=gen(rng);const tg=tagBody(cand.body);const p1=d>1?tags[d-2]:null,p2=d>2?tags[d-3]:null;
if(!violates(tg,p1,p2)){w=cand;tags[d-1]=tg;break;}if(tries===5){w=cand;tags[d-1]=tg;}}}out[d-1]=w;}return out;}

const elTitle=document.getElementById('wodTitle'), elBody=document.getElementById('wodBody'), elNotes=document.getElementById('wodNotes'), elType=document.getElementById('typePill'), elTime=document.getElementById('timePill'), elTarget=document.getElementById('targetPill'), elTribute=document.getElementById('wodTribute'), dateChip=document.getElementById('todayStr'), cal=document.getElementById('cal'), warn=document.getElementById('warn');
let currentDate=new Date(); let currentYear=currentDate.getFullYear(); let YEAR=[];
function isCommemorative(title){return !!(TRIBUTES&&TRIBUTES[title])}
function paceHint(w){return (w.type==='For Time')?'Target: 30-60 min':'Target: '+w.time+' min'}
function renderByDate(dt){if(dt.getFullYear()!==currentYear){currentYear=dt.getFullYear();YEAR=buildYear(currentYear);}const doy=doyFromDate(dt);const w=YEAR[clamp(doy,1,daysInYear(currentYear))-1];
dateChip.textContent=fmtDate(dt);elTitle.textContent=w.named? (w.title+' (Benchmark)') : w.title;elType.textContent=w.type;elTime.textContent=w.time;elTarget.textContent=paceHint(w);
elBody.innerHTML='<ul>'+w.body.map(function(l){return '<li>'+l+'</li>';}).join('')+'</ul>';elNotes.textContent=w.notes||'';if(isCommemorative(w.title)){elTribute.style.display='block';elTribute.textContent=(TRIBUTES[w.title]||'');}else{elTribute.style.display='none';elTribute.textContent='';}
document.getElementById('warmup').innerHTML=(function(){const m=modalitiesFrom(w),p=[];if(m.run)p.push(WU.run);if(m.row)p.push(WU.row);if(m.rope)p.push(WU.rope);if(m.pull)p.push(WU.pull);if(m.ttb)p.push(WU.ttb);if(m.hspu)p.push(WU.hspu);if(m.wb||m.squat)p.push(WU.squat);if(m.hinge)p.push(WU.hinge);if(m.kb)p.push(WU.kb);if(m.db)p.push(WU.db);if(m.box)p.push(WU.box);if(!p.length)p.push(WU.general);return p.slice(0,3).join('<br><br>');})();
document.getElementById('cooldown').innerHTML=(function(){const m=modalitiesFrom(w),p=[];if(m.run)p.push(CD.run);if(m.row)p.push(CD.row);if(m.rope)p.push(CD.rope);if(m.pull)p.push(CD.pull);if(m.ttb)p.push(CD.ttb);if(m.hspu)p.push(CD.hspu);if(m.wb||m.squat)p.push(CD.squat);if(m.hinge)p.push(CD.hinge);if(m.kb)p.push(CD.kb);if(m.db)p.push(CD.db);if(m.box)p.push(CD.box);if(!p.length)p.push(CD.general);return p.slice(0,2).join('<br><br>');})();
currentDate=dt;if(cal.classList.contains('show'))buildCalendar(calYear,calMonth);}
const MONTHS=['January','February','March','April','May','June','July','August','September','October','November','December'], DOW=['S','M','T','W','T','F','S'];let calYear=currentDate.getFullYear(), calMonth=currentDate.getMonth();
function buildCalendar(year,month){calYear=year;calMonth=month;const first=new Date(year,month,1),firstDow=first.getDay();const daysThis=new Date(year,month+1,0).getDate(),daysPrev=new Date(year,month,0).getDate();
let html='<header><button class="hdr-btn" id="calPrev">&larr;</button><div class="label">'+MONTHS[month]+' '+year+'</div><button class="hdr-btn" id="calNext">&rarr;</button></header><div class="grid">';
for(const d of DOW)html+='<div class="dow">'+d+'</div>';for(let i=0;i<firstDow;i++){const day=daysPrev-firstDow+1+i;html+='<div class="day muted">'+day+'</div>';}
const today=new Date();const isThisMonth=(today.getFullYear()===year&&today.getMonth()===month);const sel=isThisMonth?today.getDate():null;
for(let d=1;d<=daysThis;d++){const isSelected=(currentDate.getFullYear()===year&&currentDate.getMonth()===month&&currentDate.getDate()===d);const cls='day'+(isThisMonth&&d===sel?' today':'')+(isSelected?' selected':'');html+='<div class="'+cls+'" data-day="'+d+'">'+d+'</div>';}
const used=firstDow+daysThis;const need=(7-(used%7))%7;for(let i=1;i<=need;i++)html+='<div class="day muted">'+i+'</div>';html+='</div>';cal.innerHTML=html;
document.getElementById('calPrev').onclick=function(ev){ev.stopPropagation();const m=calMonth-1;const y=m<0?calYear-1:calYear;const nm=m<0?11:m;buildCalendar(y,nm);};
document.getElementById('calNext').onclick=function(ev){ev.stopPropagation();const m=calMonth+1;const y=m>11?calYear+1:calYear;const nm=m>11?0:m;buildCalendar(y,nm);};
cal.querySelectorAll('.day[data-day]').forEach(function(el){el.onclick=function(ev){ev.stopPropagation();const day=+el.getAttribute('data-day');renderByDate(new Date(calYear,calMonth,day));closeCalendar();};});}
function openCalendar(){buildCalendar(currentDate.getFullYear(),currentDate.getMonth());cal.classList.add('show');cal.setAttribute('aria-hidden','false');setTimeout(function(){document.addEventListener('click',outsideClose);},0);}
function closeCalendar(){cal.classList.remove('show');cal.setAttribute('aria-hidden','true');document.removeEventListener('click',outsideClose);}
function outsideClose(e){const inside=(e.composedPath&&e.composedPath().includes(cal))||cal.contains(e.target);if(!inside&&e.target!==dateChip){closeCalendar();}}
function ensureWodsLoaded(next){BENCH=Array.isArray(window.WOD_BANK)?window.WOD_BANK:[];TRIBUTES=Object.assign({},DEFAULT_TRIBUTES,window.WOD_TRIBUTES||{});DATE_MAP=(window.WOD_DATE_MAP&&typeof window.WOD_DATE_MAP==='object')?window.WOD_DATE_MAP:{};next();}
function init(){ensureWodsLoaded(function(){if(!BENCH.length){warn.style.display='block';warn.textContent='Heads up: 0 known WODs loaded from wods.js — using generators only.';}else if(BENCH.length<20){warn.style.display='block';warn.textContent='Only '+BENCH.length+' known WODs loaded from wods.js.';}
YEAR=buildYear(currentYear);renderByDate(new Date());document.getElementById('prevBtn').onclick=function(){const d=new Date(currentDate);d.setDate(d.getDate()-1);renderByDate(d);};
document.getElementById('nextBtn').onclick=function(){const d=new Date(currentDate);d.setDate(d.getDate()+1);renderByDate(d);};document.getElementById('todayBtn').onclick=function(){renderByDate(new Date());};
const chip=document.getElementById('todayStr');chip.addEventListener('click',function(e){e.stopPropagation();if(cal.classList.contains('show'))closeCalendar();else openCalendar();});
document.addEventListener('keydown',function(e){if(e.key==='Escape'&&cal.classList.contains('show'))closeCalendar();});
const icon192=document.querySelector('link[rel="apple-touch-icon"]').href;const manifest={name:'BAMBAM — Daily WOD',short_name:'Daily WOD',start_url:'/',display:'standalone',background_color:'#0f1115',theme_color:'#0f1115',icons:[{src:icon192,sizes:'192x192',type:'image/png'},{src:icon192,sizes:'512x512',type:'image/png'}]};
const manBlob=new Blob([JSON.stringify(manifest)],{type:'application/manifest+json'});const manLink=document.createElement('link');manLink.rel='manifest';manLink.href=URL.createObjectURL(manBlob);document.head.appendChild(manLink);
if('serviceWorker' in navigator){const swCode="const CACHE='bb-wod-v1';self.addEventListener('install',e=>{e.waitUntil(caches.open(CACHE).then(c=>c.addAll(['/'])));self.skipWaiting();});self.addEventListener('activate',e=>{self.clients.claim();});self.addEventListener('fetch',e=>{const req=e.request;if(req.mode==='navigate'){e.respondWith(fetch(req).catch(()=>caches.match('/')));return;}e.respondWith(caches.match(req).then(r=>r||fetch(req)));});";
const swURL=URL.createObjectURL(new Blob([swCode],{type:'text/javascript'}));navigator.serviceWorker.register(swURL,{scope:'/'}).catch(()=>{});} });}
document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>